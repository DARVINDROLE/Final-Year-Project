(fyp-api) PS D:\Final-year-project\Final-Year-Project> python api/tests/test_webcam_ring.py --voice
=======================================================
  Smart Doorbell - Webcam + Voice Test
=======================================================
  Mode: IMAGE + VOICE (record with R, capture with SPACE)

=== Webcam Preview ===
Press R to START/STOP voice recording (then SPACE to send)
Press SPACE to capture image and send to doorbell API
Press Q to quit without sending
======================

  [MIC] Recording started... speak now
  [MIC] Recording stopped — 6.5s captured
Captured frame: 640x480, base64 size: 38764 chars
Audio base64 size: 275856 chars

Sending ring event to API...
Ring response: {
  "sessionId": "visitor_e6e23dae",
  "status": "queued",
  "imagePath": "data/snaps/visitor_e6e23dae.jpg",
  "audioPath": "data/tmp/visitor_e6e23dae/ring_audio.wav"
}

Polling session visitor_e6e23dae...
  Status: processing
  Status: perception_done
  Status: completed

Final result: {
  "sessionId": "visitor_e6e23dae",
  "status": "completed",
  "lastUpdated": "2026-02-14T14:25:32.305401+00:00",
  "riskScore": 0.255
}

--- Pipeline completed successfully! ---
  Risk Score: 0.255

  Visitor said: (no transcript — VOSK returned empty)
    Possible causes:
    - Mic volume too low or wrong input device
    - VOSK models not loaded (check server logs)
    - Recording too short (try speaking longer)
  AI Reply:     "Please wait while I notify the owner."

  [TTS] Speaking: "Please wait while I notify the owner."